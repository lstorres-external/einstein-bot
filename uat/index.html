<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sofia V2 - UAT</title>
    <script type="text/javascript">
      function getLanguageFromQueryString() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get('language') || 'en-US';  
      }

      function getIsPrivateFromQueryString() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.has('private');
      }

      function initEmbeddedMessaging() {
        try {
          var language = getLanguageFromQueryString();
          var isPrivate = getIsPrivateFromQueryString();

          alert('language=== ' + language);
          embeddedservice_bootstrap.settings.language = language;
          document.getElementById("languageInfo").innerHTML = `O idioma foi ajustado para: ${language} \n Área privada: ${isPrivate}`;

          console.log("onEmb");
          if(isPrivate) {
            window.addEventListener("onEmbeddedMessagingReady", (e) => {
              console.log("iniciando prechatAPI hidden");
              embeddedservice_bootstrap.prechatAPI.setHiddenPrechatFields({
                FirstName: "Test",
                LastName: "Test",
                Email: "test@test.com",
                Language: language,
                Customer_Identifier: "CustomerID",
                Source: "Source",
                Country: "Country",
                //encrypted token
                Encrypted_ID_Token_P1: "encp1",
                Encrypted_ID_Token_P2: "encp2",
                Encrypted_ID_Token_P3: "encp3",
                Encrypted_ID_Token_P4: "encp4",
                Encrypted_ID_Token_P5: "encp5",
                Encrypted_ID_Token_P6: "encp6",
                Encrypted_ID_Token_P7: "encp7",
                Encrypted_ID_Token_P8: "encp8",
                Encrypted_ID_Token_P9: "encp9",
                Encrypted_ID_Token_P10: "",
                Encrypted_ID_Token_P11: "",
                Encrypted_ID_Token_P12: "",
                Encrypted_ID_Token_P13: "",
                Encrypted_ID_Token_P14: "",
                Encrypted_ID_Token_P15: "",
              });
            });

            embeddedservice_bootstrap.init(
      				'00D1x0000000MUW',
      				'Sofia_Private_Portal',
      				'https://visa-gateway--vgint.sandbox.my.site.com/ESWSofiaPrivatePortal1756901319803',
      				{
      					scrt2URL: 
                  'https://visa-gateway--vgint.sandbox.my.salesforce-scrt.com'
      				}
      			);
          }
          else {
            embeddedservice_bootstrap.init(
              "00D1x0000000MUW",
              "Sofia_Public_Portal",
              "https://visa-gateway--vgint.sandbox.my.site.com/ESWsofiav21731496032237",
              {
                scrt2URL:
                  "https://visa-gateway--vgint.sandbox.my.salesforce-scrt.com",
              }
            );
          }
        } catch (err) {
          console.error("Error loading Embedded Messaging: ", err);
        }
      }

      function loadBootstrapAndInit() {
        var isPrivate = getIsPrivateFromQueryString();
        var scriptSrc = isPrivate
          ? 'https://visa-gateway--vgint.sandbox.my.site.com/ESWSofiaPrivatePortal1756901319803/assets/js/bootstrap.min.js'
          : 'https://visa-gateway--vgint.sandbox.my.site.com/ESWsofiav21731496032237/assets/js/bootstrap.min.js';

        var s = document.createElement('script');
        s.type = 'text/javascript';
        s.src = scriptSrc;

        alert('is private: ' + isPrivate);

        s.onload = function() {
          initEmbeddedMessaging();
        };
        document.head.appendChild(s);
      }

      document.addEventListener('DOMContentLoaded', loadBootstrapAndInit);
    </script>
  </head>
  <body>

    <div style="display: flex;">
      <button onclick="window.location.href = 'https://lstorres-external.github.io/einstein-bot/uat/?language=en_US';">English (US)</button>
      <button onclick="window.location.href = 'https://lstorres-external.github.io/einstein-bot/uat/?language=pt_BR';">Português (BR)</button>
      <button onclick="window.location.href = 'https://lstorres-external.github.io/einstein-bot/uat/?language=es';">Español (ES)</button>
    </div>
    <div style="text-align: center; margin-top: 20px;">
     <p id="languageInfo"></p>
      
    </div>
  </body>
</html>
