<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sofia V2 - UAT</title>
    <script type="text/javascript">
      function getLanguageFromQueryString() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get('language') || 'en-US'; 
      }

      function getIsPrivateFromQueryString() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.has('private');
      }

      function initEmbeddedMessaging() {
        try {
          var language = getLanguageFromQueryString();
          var isPrivate = getIsPrivateFromQueryString();

          alert('language=== ' + language);
          embeddedservice_bootstrap.settings.language = language;
          document.getElementById("languageInfo").innerHTML = `O idioma foi ajustado para: ${language}`;

          window.addEventListener("onEmbeddedMessagingReady", (e) => {
            embeddedservice_bootstrap.prechatAPI.setVisiblePrechatFields({
              FirstName: {
                value: "Test",
                isEditableByEndUser: false,
              },
              LastName: {
                value: "Test",
                isEditableByEndUser: false,
              },
              Email: {
                value: "test@test.com",
                isEditableByEndUser: false,
              },
              Language: {
                value: language,
                isEditableByEndUser: false,
              },
              Customer_Identifier: {
                value: "CustomerID",
                isEditableByEndUser: false,
              },
              Source: {
                value: "Source",
                isEditableByEndUser: false,
              },
              Country: {
                value: "Country",
                isEditableByEndUser: false,
              },
            });
          });

          if(isPrivate) {
            embeddedservice_bootstrap.init(
      				'00D1x0000000MUW',
      				'Sofia_Private_Portal',
      				'https://visa-gateway--vgint.sandbox.my.site.com/ESWSofiaPrivatePortal1756901319803',
      				{
      					scrt2URL: 
                  'https://visa-gateway--vgint.sandbox.my.salesforce-scrt.com'
      				}
      			);
          }
          else { 
            embeddedservice_bootstrap.init(
              "00D1x0000000MUW",
              "Sofia_Public_Portal",
              "https://visa-gateway--vgint.sandbox.my.site.com/ESWsofiav21731496032237",
              {
                scrt2URL:
                  "https://visa-gateway--vgint.sandbox.my.salesforce-scrt.com",
              }
            );
          }
        } catch (err) {
          console.error("Error loading Embedded Messaging: ", err);
        }
      }

      function loadBootstrapAndInit() {
        var isPrivate = getIsPrivateFromQueryString();
        var scriptSrc = isPrivate
          ? 'https://visa-gateway--vgint.sandbox.my.site.com/ESWSofiaPrivatePortal1756901319803/assets/js/bootstrap.min.js'
          : 'https://visa-gateway--vgint.sandbox.my.site.com/ESWsofiav21731496032237/assets/js/bootstrap.min.js';

        var s = document.createElement('script');
        s.type = 'text/javascript';
        s.src = scriptSrc;

        s.onload = function() {
          initEmbeddedMessaging();
        };
        document.head.appendChild(s);
      }

      document.addEventListener('DOMContentLoaded', loadBootstrapAndInit);
    </script>
  </head>
  <body>

    <div style="display: flex;">
      <button onclick="window.location.href = 'https://lstorres-external.github.io/einstein-bot/uat/?language=en_US';">English (US)</button>
      <button onclick="window.location.href = 'https://lstorres-external.github.io/einstein-bot/uat/?language=pt_BR';">Português (BR)</button>
      <button onclick="window.location.href = 'https://lstorres-external.github.io/einstein-bot/uat/?language=es';">Español (ES)</button>
    </div>
    <div style="text-align: center; margin-top: 20px;">
     <p id="languageInfo"></p>
      
    </div>
  </body>
</html>
