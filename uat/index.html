<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sofia V2 - UAT</title>
    <script type="text/javascript">
      var language = "en_US";
      var isPrivate = false;

      function getLanguageFromQueryString() {
        const urlParams = new URLSearchParams(window.location.search); 
        return urlParams.get("language") || "en_US";
      }

      function getIsPrivateFromQueryString() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.has("private");
      }

      function initEmbeddedMessaging() {
        try {
          embeddedservice_bootstrap.settings.language = language;
          document.getElementById(
            "languageInfo"
          ).innerHTML = ` O idioma foi ajustado para: ${language} <br> Área privada: ${
            isPrivate ? "Sim" : "Não"
          }`;

          console.log("onEmb");
          if (isPrivate) {
            window.addEventListener("onEmbeddedMessagingReady", (e) => {
              console.log("iniciando prechatAPI hidden");
              embeddedservice_bootstrap.prechatAPI.setHiddenPrechatFields({
                Language: language,
                Source: "Source",
                IsPrivatePortal: "True",
                BIN_Number: "4761129420",
                //encrypted token
                Encrypted_ID_Token_P1:
                  "exemple1",
                Encrypted_ID_Token_P2:
                  "exemple2",
                Encrypted_ID_Token_P3:
                  "exemple3",
                Encrypted_ID_Token_P4:
                  "exemple4",
                Encrypted_ID_Token_P5:
                  "exemple5",
                Encrypted_ID_Token_P6:
                  "exemple6",
                Encrypted_ID_Token_P7:
                  "exemple7",
                Encrypted_ID_Token_P8:
                  "exemple8",
                Encrypted_ID_Token_P9:
                  "exemple9",
                Encrypted_ID_Token_P10:
                  "exemple10",
                Encrypted_ID_Token_P11:
                  "exemple11",
                Encrypted_ID_Token_P12:
                  "exemple12",
                Encrypted_ID_Token_P13:
                  "exemple13",
                Encrypted_ID_Token_P14:
                  "exemple14",
                Encrypted_ID_Token_P15:
                  "exemple15",
                Encrypted_ID_Token_P16:
                  "exemple16",
                Encrypted_ID_Token_P17:
                  "exemple17",
                Encrypted_ID_Token_P18:
                  "exemple18",
                Encrypted_ID_Token_P19:
                  "exemple19",
                Encrypted_ID_Token_P20:
                  "exemple20",
            
              });
            });

            embeddedservice_bootstrap.init(
              "00D9V00000N0u8F",
              "Sofia_Private_Portal",
              "https://visa-gateway--uat.sandbox.my.site.com/ESWSofiaPrivatePortal1763426141089",
              {
                scrt2URL:
                  "https://visa-gateway--uat.sandbox.my.salesforce-scrt.com",
              }
            );
          } else {
            //es
            if (language == "es") {
              embeddedservice_bootstrap.init(
                "00D9V00000N0u8F",
                "Sofia_Public_Portal_ES",
                "https://visa-gateway--uat.sandbox.my.site.com/ESWSofiaPublicPortalES1763424858243",
                {
                  scrt2URL:
                    "https://visa-gateway--uat.sandbox.my.salesforce-scrt.com",
                }
              );
            }
            //pt_BR
            else if (language == "pt_BR") {
              embeddedservice_bootstrap.init(
                "00D9V00000N0u8F",
                "Sofia_Public_Portal_PT",
                "https://visa-gateway--uat.sandbox.my.site.com/ESWSofiaPublicPortalPT1763425294952",
                {
                  scrt2URL:
                    "https://visa-gateway--uat.sandbox.my.salesforce-scrt.com",
                }
              );
            }
            //en_US
            else {
              embeddedservice_bootstrap.init(
                "00D9V00000N0u8F",
                "Sofia_Public_Portal",
                "https://visa-gateway--uat.sandbox.my.site.com/ESWSofia1746619645236",
                {
                  scrt2URL:
                    "https://visa-gateway--uat.sandbox.my.salesforce-scrt.com",
                }
              );
            }
          }
        } catch (err) {
          console.error("Error loading Embedded Messaging: ", err);
        }
      }

      function loadBootstrapAndInit() {
        language = getLanguageFromQueryString();
        isPrivate = getIsPrivateFromQueryString();

        var scriptSrc =
          "https://visa-gateway--uat.sandbox.my.site.com/ESWSofia1746619645236/assets/js/bootstrap.min.js";
        if (isPrivate) {
          scriptSrc =
            "https://visa-gateway--uat.sandbox.my.site.com/ESWSofiaPrivatePortal1763426141089/assets/js/bootstrap.min.js";
        } else if (language == "es") {
          scriptSrc =
            "https://visa-gateway--uat.sandbox.my.site.com/ESWSofiaPublicPortalES1763424858243/assets/js/bootstrap.min.js";
        } else if (language == "pt_BR") {
          scriptSrc =
            "https://visa-gateway--uat.sandbox.my.site.com/ESWSofiaPublicPortalPT1763425294952/assets/js/bootstrap.min.js";
        }

        var s = document.createElement("script");
        s.type = "text/javascript";
        s.src = scriptSrc;

        s.onload = function () {
          initEmbeddedMessaging();
        };
        document.head.appendChild(s);
      }

      document.addEventListener("DOMContentLoaded", loadBootstrapAndInit);
    </script>
  </head>
  <body>
    <div style="margin: 10px; text-align: center">
      <button
        onclick="window.location.href = 'https://lstorres-external.github.io/einstein-bot/uat/?language=en_US';"
      >
        English (US)
      </button>
      <button
        onclick="window.location.href = 'https://lstorres-external.github.io/einstein-bot/uat/?language=pt_BR';"
      >
        Português (BR)
      </button>
      <button
        onclick="window.location.href = 'https://lstorres-external.github.io/einstein-bot/uat/?language=es';"
      >
        Español (ES)
      </button>
    </div>

    <div style="margin: 10px; text-align: center">
      <button onclick="togglePrivateParam()">Toggle Private</button>
      <button onclick="reloadWithCurrentParams()">Recarregar</button>
    </div>

    <div style="text-align: center; margin-top: 20px">
      <p id="languageInfo"></p>
    </div>

    <script>
      function togglePrivateParam() {
        const url = new URL(window.location.href);
        if (url.searchParams.has("private")) {
          url.searchParams.delete("private");
        } else {
          url.searchParams.set("private", "1");
        }
        window.location.href = url.toString();
      }

      function reloadWithCurrentParams() {
        window.location.reload();
      }
    </script>
  </body>
</html>
