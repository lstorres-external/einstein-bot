<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sofia V2 - UAT</title>
    <script type="text/javascript">
      var language = "en_US";
      var isPrivate = false;

      function getLanguageFromQueryString() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get("language") || "en_US";
      }

      function getIsPrivateFromQueryString() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.has("private");
      }

      function initEmbeddedMessaging() {
        try {
          alert("language=== " + language);
          embeddedservice_bootstrap.settings.language = language;
          document.getElementById(
            "languageInfo"
          ).innerHTML = `O idioma foi ajustado para: ${language} \n Área privada: ${isPrivate}`;

          console.log("onEmb");
          if (isPrivate) {
            window.addEventListener("onEmbeddedMessagingReady", (e) => {
              console.log("iniciando prechatAPI hidden");
              embeddedservice_bootstrap.prechatAPI.setHiddenPrechatFields({
                //FirstName: "Test",
                //LastName: "Test",
                //Email: "test@test.com",
                Language: language,
                //Customer_Identifier: "CustomerID",
                Source: "Source",
                //Country: "Country",
                IsPrivatePortal: "True",
                //encrypted token
                Encrypted_ID_Token_P1:
                  "encp10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
                Encrypted_ID_Token_P2:
                  "encp20000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
                Encrypted_ID_Token_P3:
                  "encp30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
                Encrypted_ID_Token_P4:
                  "encp40000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
                Encrypted_ID_Token_P5:
                  "encp50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
                Encrypted_ID_Token_P6:
                  "encp60000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
                Encrypted_ID_Token_P7:
                  "encp70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
                Encrypted_ID_Token_P8:
                  "encp80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
                Encrypted_ID_Token_P9:
                  "encp90000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
                Encrypted_ID_Token_P10:
                  "encp10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
                Encrypted_ID_Token_P11:
                  "encp11000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
                Encrypted_ID_Token_P12:
                  "encp12000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
                Encrypted_ID_Token_P13:
                  "encp13000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
                Encrypted_ID_Token_P14:
                  "encp14000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
                Encrypted_ID_Token_P15:
                  "encp15000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
              });
            });

            embeddedservice_bootstrap.init(
              "00D1x0000000MUW",
              "Sofia_Private_Portal",
              "https://visa-gateway--vgint.sandbox.my.site.com/ESWSofiaPrivatePortal1756901319803",
              {
                scrt2URL:
                  "https://visa-gateway--vgint.sandbox.my.salesforce-scrt.com",
              }
            );
          } else {
            //es
            if (language == "es") {
              embeddedservice_bootstrap.init(
                "00D1x0000000MUW",
                "Sofia_Public_Portal_ES",
                "https://visa-gateway--vgint.sandbox.my.site.com/ESWSofiaPublicPortalES1760975422873",
                {
                  scrt2URL:
                    "https://visa-gateway--vgint.sandbox.my.salesforce-scrt.com",
                }
              );
            }
            //pt_BR
            else if (language == "pt_BR") {
              embeddedservice_bootstrap.init(
                "00D1x0000000MUW",
                "Sofia_Public_Portal_PT",
                "https://visa-gateway--vgint.sandbox.my.site.com/ESWSofiaPublicPortalPT1760975550562",
                {
                  scrt2URL:
                    "https://visa-gateway--vgint.sandbox.my.salesforce-scrt.com",
                }
              );
            }
            //en_US
            else {
              embeddedservice_bootstrap.init(
                "00D1x0000000MUW",
                "Sofia_Public_Portal",
                "https://visa-gateway--vgint.sandbox.my.site.com/ESWsofiav21731496032237",
                {
                  scrt2URL:
                    "https://visa-gateway--vgint.sandbox.my.salesforce-scrt.com",
                }
              );
            }
          }
        } catch (err) {
          console.error("Error loading Embedded Messaging: ", err);
        }
      }

      function loadBootstrapAndInit() {
        language = getLanguageFromQueryString();
        isPrivate = getIsPrivateFromQueryString();

        var scriptSrc =
          "https://visa-gateway--vgint.sandbox.my.site.com/ESWsofiav21731496032237/assets/js/bootstrap.min.js";
        if (isPrivate) {
          scriptSrc =
            "https://visa-gateway--vgint.sandbox.my.site.com/ESWSofiaPrivatePortal1756901319803/assets/js/bootstrap.min.js";
        } else if (language == "es") {
          scriptSrc =
            "https://visa-gateway--vgint.sandbox.my.site.com/ESWSofiaPublicPortalES1760975422873/assets/js/bootstrap.min.js";
        } else if (language == "pt_BR") {
          scriptSrc =
            "https://visa-gateway--vgint.sandbox.my.site.com/ESWSofiaPublicPortalPT1760975550562/assets/js/bootstrap.min.js";
        }

        var s = document.createElement("script");
        s.type = "text/javascript";
        s.src = scriptSrc;

        alert("is private: " + isPrivate);

        s.onload = function () {
          initEmbeddedMessaging();
        };
        document.head.appendChild(s);
      }

      document.addEventListener("DOMContentLoaded", loadBootstrapAndInit);
    </script>
  </head>
  <body>
    <div style="display: flex">
      <button
        onclick="window.location.href = 'https://lstorres-external.github.io/einstein-bot/uat/?language=en_US';"
      >
        English (US)
      </button>
      <button
        onclick="window.location.href = 'https://lstorres-external.github.io/einstein-bot/uat/?language=pt_BR';"
      >
        Português (BR)
      </button>
      <button
        onclick="window.location.href = 'https://lstorres-external.github.io/einstein-bot/uat/?language=es';"
      >
        Español (ES)
      </button>
    </div>

    <div style="margin: 10px; text-align: center">
      <button onclick="togglePrivateParam()">Toggle Private</button>
      <button onclick="reloadWithCurrentParams()">Recarregar</button>
    </div>

    <div style="text-align: center; margin-top: 20px">
      <p id="languageInfo"></p>
    </div>

    <script>
      function togglePrivateParam() {
        const url = new URL(window.location.href);
        if (url.searchParams.has("private")) {
          url.searchParams.delete("private");
        } else {
          url.searchParams.set("private", "1");
        }
        window.location.href = url.toString();
      }

      function reloadWithCurrentParams() {
        window.location.reload();
      }
    </script>
  </body>
</html>
